let formReady=e=>{"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",e)};formReady(()=>{const e=15,t=1,n=2,d=10,s=1,l=1440,i=4500,a=!0;let r=document.getElementById("tradeForm"),o=new FormData,c=document.getElementById("itemsWrapper"),m=document.getElementById("addItem"),u=document.getElementById("removeItem"),p=document.getElementById("tradeSubmit"),b=document.getElementById("submitHelp"),g=document.getElementById("submissionResults");function y(){if(document.querySelectorAll(".tradeItem").length>e-1)return;document.querySelectorAll(".tradeItem").length==e-1&&(m.disabled=!0);let s=document.querySelectorAll(".tradeItem").length+1,l=document.createElement("div");l.classList.add("row"),l.classList.add("tradeItem"),l.id="tradeItem"+s;let a=document.createElement("div");a.classList.add("col"),l.appendChild(a);let r=document.createElement("h4");r.id="tradeItemHeader"+s,r.setAttribute("data-toggle","collapse"),r.setAttribute("data-target","#tradeItemForm"+s),r.setAttribute("aria-expanded","true"),r.setAttribute("aria-controls","tradeItemForm"+s),r.classList.add("itemHeader"),r.innerHTML="Item "+s,a.appendChild(r);let o=document.createElement("div");o.classList.add("collapse"),o.classList.add("show"),o.classList.add("multi-collapse"),o.id="tradeItemForm"+s;let p=document.createElement("div");p.classList.add("form-group");let b=document.createElement("label");b.setAttribute("for","makeModel"+s),b.innerHTML='Make, Model, and Color <span class="text-danger" role="none">*</span>';let g=document.createElement("input");g.setAttribute("type","text"),g.classList.add("form-control"),g.setAttribute("id","makeModel"+s),g.setAttribute("name","makeModel"+s),g.setAttribute("aria-describedby","makeModelHelpElement"+s),g.setAttribute("placeholder","E.g. EMPIRE AXE 2.0 Dust Black"),g.setAttribute("minlength","8"),g.required=!0;let y=document.createElement("small");y.setAttribute("id","makeModelHelpElement"+s),y.classList.add("form-text"),y.classList.add("text-muted"),y.innerHTML="",p.appendChild(b),p.appendChild(g),p.appendChild(y),o.appendChild(p);let L=document.createElement("div");L.classList.add("form-group");let E=document.createElement("label");E.setAttribute("for","qty"+s),E.innerHTML='Quantity <span class="text-danger" role="none">*</span>';let f=document.createElement("input");f.setAttribute("type","number"),f.classList.add("form-control"),f.setAttribute("id","qty"+s),f.setAttribute("name","qty"+s),f.setAttribute("aria-describedby","qtyHelpElement"),f.setAttribute("placeholder","E.g. 1"),f.setAttribute("min","1"),f.required=!0;let A=document.createElement("small");A.setAttribute("id","qtyHelpElement"+s),A.classList.add("form-text"),A.classList.add("text-muted"),A.innerHTML="How many of this item do you have?",L.appendChild(E),L.appendChild(f),L.appendChild(A),o.appendChild(L);let v=document.createElement("div");v.classList.add("form-group");let x=document.createElement("label");x.setAttribute("for","condition"+s),x.innerHTML='Condition <span class="text-danger" role="none">*</span>';let I=document.createElement("input");I.setAttribute("type","text"),I.classList.add("form-control"),I.setAttribute("id","condition"+s),I.setAttribute("name","condition"+s),I.setAttribute("aria-describedby","conditionHelpElement"),I.setAttribute("placeholder","E.g. Used"),I.setAttribute("minlength","4"),I.required=!0;let H=document.createElement("small");H.setAttribute("id","conditionHelpElement"+s),H.classList.add("form-text"),H.classList.add("text-muted"),H.innerHTML='If used please write "Used" and describe the visual and operational condition of the item(s). If brand new write "Brand New".',v.appendChild(x),v.appendChild(I),v.appendChild(H),o.appendChild(v);let M=document.createElement("div");M.classList.add("form-group");let C=document.createElement("label");C.setAttribute("for","upgradesMods"+s),C.innerHTML="Upgrades / Modifications (If Applicable)";let S=document.createElement("textarea");S.classList.add("form-control"),S.setAttribute("id","upgradesMods"+s),S.setAttribute("name","upgradesMods"+s),S.setAttribute("aria-describedby","upgradesModsHelpElement"),S.setAttribute("placeholder","E.g. Reflex Engine");let T=document.createElement("small");T.setAttribute("id","upgradesModsHelpElement"+s),T.classList.add("form-text"),T.classList.add("text-muted"),T.innerHTML="",M.appendChild(C),M.appendChild(S),M.appendChild(T),o.appendChild(M);let q=document.createElement("div");q.classList.add("form-group");let w=document.createElement("label");w.setAttribute("for","accessories"+s),w.innerHTML="Accessories (If Applicable)";let B=document.createElement("textarea");B.classList.add("form-control"),B.setAttribute("id","accessories"+s),B.setAttribute("name","accessories"+s),B.setAttribute("aria-describedby","accessoriesHelpElement"),B.setAttribute("placeholder","E.g. Barrel Bag");let F=document.createElement("small");F.setAttribute("id","accessoriesHelpElement"+s),F.classList.add("form-text"),F.classList.add("text-muted"),F.innerHTML="What all is included with the item(s)?",q.appendChild(w),q.appendChild(B),q.appendChild(F),o.appendChild(q);let k=document.createElement("div");k.classList.add("form-group");let P=document.createElement("label");P.setAttribute("for","pictures"+s+"[]"),P.innerHTML=0==n?"Pictures":'Pictures <span class="text-danger" role="none">*</span>';let $=document.createElement("input");$.setAttribute("type","file"),$.setAttribute("accept","image/png, image/jpeg"),$.classList.add("form-control-file"),$.setAttribute("id","pictures"+s),$.setAttribute("name","pictures"+s+"[]"),$.setAttribute("aria-describedby","picturesHelpElement"),0!=n&&($.required=!0),$.multiple=!0;let R=document.createElement("small");R.setAttribute("id","picturesHelpElement"+s),R.classList.add("form-text"),R.classList.add("text-muted"),R.innerHTML=`Provide ${n}-${d} pictures.`,$.addEventListener("input",()=>{$.files.length>d?(h(R,"Too many pictures selected.","warning",i),$.value=""):$.files.length<n&&(h(R,"Select more pictures.","warning",i),$.value="")}),k.appendChild(P),k.appendChild($),k.appendChild(R),o.appendChild(k);let O=document.createElement("div");O.classList.add("form-group");let W=document.createElement("label");W.setAttribute("for","video"+s),W.innerHTML="Video";let z=document.createElement("input");z.setAttribute("type","url"),z.classList.add("form-control"),z.setAttribute("id","video"+s),z.setAttribute("name","video"+s),z.setAttribute("aria-describedby","videoHelpElement"),z.setAttribute("placeholder","E.g. https://youtu.be/dQw4w9WgXcQ");let D=document.createElement("small");D.setAttribute("id","videoHelpElement"+s),D.classList.add("form-text"),D.classList.add("text-muted"),D.innerHTML="If you have a video of your item(s) on YouTube or elsewhere you can put the URL link here.",O.appendChild(W),O.appendChild(z),O.appendChild(D),o.appendChild(O),a.appendChild(o),c.appendChild(l),document.querySelectorAll(".tradeItem").length>t&&(u.disabled=!1)}function L(){setTimeout(()=>{p.innerHTML="Submit",p.classList.add("btn-success"),p.classList.remove("btn-primary"),p.disabled=!1,document.getElementById("introSection").style.display="initial",document.getElementById("personalInfoSection").style.display="initial",document.getElementById("itemsSection").style.display="initial",document.getElementById("tradeOptionsSection").style.display="initial",document.getElementById("submitSection").style.display="initial",g.innerHTML="",b.innerHTML=""},i)}function h(e,t,n,d,s){let l;function i(){"function"==typeof s&&s()}l=void 0===e.innerHTML?"":e.innerHTML,"warning"==n?(e.classList.add("text-danger"),e.classList.remove("text-muted"),e.classList.remove("text-primary"),e.classList.remove("text-success")):"pending"==n?(e.classList.add("text-primary"),e.classList.remove("text-muted"),e.classList.remove("text-danger"),e.classList.remove("text-success")):"success"==n&&(e.classList.add("text-success"),e.classList.remove("text-muted"),e.classList.remove("text-danger"),e.classList.remove("text-primary")),e.innerHTML=t,0!=d?setTimeout(()=>{e.classList.add("text-muted"),e.classList.remove("text-danger"),e.classList.remove("text-primary"),e.classList.remove("text-success"),e.innerHTML=l,i()},d):i()}m.addEventListener("click",()=>{y()}),u.addEventListener("click",()=>{document.querySelectorAll(".tradeItem").length>t&&(c.removeChild(c.lastChild),document.querySelectorAll(".tradeItem").length==t&&(u.disabled=!0)),document.querySelectorAll(".tradeItem").length<e&&(m.disabled=!1)}),r.addEventListener("submit",n=>{p.innerHTML="Validating...",p.classList.add("btn-primary"),p.classList.remove("btn-success"),p.disabled=!0,document.getElementById("introSection").style.display="none",document.getElementById("personalInfoSection").style.display="none",document.getElementById("itemsSection").style.display="none",document.getElementById("tradeOptionsSection").style.display="none",async function(){if(document.querySelectorAll(".tradeItem").length<t)return h(b,"Not enough trade items!","warning",i),!1;if(document.querySelectorAll(".tradeItem").length>e)return h(b,"Too many trade items!","warning",i),!1;let n=0,d=0,a=Array.from(document.querySelectorAll("input[type=file]"));for(let e=0;e<a.length;e++){let t=Array.from(a[e].files);for(let r=0;r<t.length;r++){n+=t[r].size;const c={maxSizeMB:s,maxWidthOrHeight:l,useWebWorker:!1,onProgress:e=>h(b,`Compressing ${t[r].name} (${e}%)`,"pending",0)};try{const n=await imageCompression(t[r],c);o.append(`compressedPictures${e+1}[]`,n,n.name),d+=n.size}catch(n){h(b,`Failed to compress ${t[r].name}. Please remove it or try again.`,"warning",i),a[e].value="";for(let e=0;e<a.length;e++)o.delete(`compressedPictures${e+1}[]`);return console.log(n),!1}}}if(h(b,`Compression finished and saved ${((n-d)/1024/1024).toFixed(2)} MBs. New total file upload size: ${(d/1024/1024).toFixed(2)} MBs.`,"success",0),(d/1024/1024).toFixed(2)>25){h(b,`Total selected picture size of ${(d/1024/1024).toFixed(2)} MBs is too large. Please remove one and try again.`,"warning",i);for(let e=0;e<a.length;e++)o.delete(`compressedPictures${e+1}[]`);return!1}return!0}().then(e=>{e?(p.innerHTML="Sending...",function(){o.append("numTradeItems",document.querySelectorAll(".tradeItem").length),document.querySelectorAll("input").forEach(e=>{-1==e.name.search("pictures")&&o.append(e.name,e.value)}),document.querySelectorAll("textarea").forEach(e=>{o.append(e.name,e.value)}),document.querySelectorAll("select").forEach(e=>{o.append(e.name,e.value)}),!0===a?o.append("debug","true"):o.append("debug","false");let e=new XMLHttpRequest;e.upload.onprogress=e=>{h(b,`Uploading (${(e.loaded/e.total*100).toFixed(0)}%)`,"pending",0)},e.onload=()=>{if(200==e.status){p.disabled=!0,p.innerHTML="Submitted!",p.classList.add("btn-success"),p.classList.remove("btn-primary"),document.getElementById("submitSection").style.display="none";let t=JSON.parse(e.response);g.innerHTML=t.header+t.body,!0===a&&(console.log("Server-Side Debug Info:"),console.log(t.debugInfo)),!1===t.isFormInputValid&&L()}else h(b,"Failed to send trade. Please check your internet connection and try again.","warning",i),L()},e.onerror=()=>{h(b,"Failed to send trade. Please check your internet connection and try again.","warning",i),L()},e.open("POST","trade.php"),e.send(o)}()):L()}).catch(e=>{console.log(e)}),n.preventDefault()}),r.addEventListener("invalid",()=>{document.querySelectorAll(".collapse").forEach(e=>{e.classList.add("show")})},!0),y(),r.style.display="initial"});