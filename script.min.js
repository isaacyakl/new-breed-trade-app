let formReady=e=>{"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",e)};formReady(()=>{const e=15,t=1,n=2,d=10,s=1,a=1440,i=4500,l=!0,r=new Date;let o=document.getElementById("tradeForm"),c=new FormData,m=document.getElementById("itemsWrapper"),u=document.getElementById("addItem"),p=document.getElementById("removeItem"),g=document.getElementById("tradeSubmit"),b=document.getElementById("submitHelp"),y=document.getElementById("submissionResults"),L=[];function h(){if(document.querySelectorAll(".tradeItem").length>e-1)return;document.querySelectorAll(".tradeItem").length==e-1&&(u.disabled=!0);let s=document.querySelectorAll(".tradeItem").length+1,a=document.createElement("div");a.classList.add("row"),a.classList.add("tradeItem"),a.id="tradeItem"+s;let l=document.createElement("div");l.classList.add("col"),a.appendChild(l);let r=document.createElement("h4");r.id="tradeItemHeader"+s,r.setAttribute("data-toggle","collapse"),r.setAttribute("data-target","#tradeItemForm"+s),r.setAttribute("aria-expanded","true"),r.setAttribute("aria-controls","tradeItemForm"+s),r.classList.add("itemHeader"),r.innerHTML="Item "+s,l.appendChild(r);let o=document.createElement("div");o.classList.add("collapse"),o.classList.add("show"),o.classList.add("multi-collapse"),o.id="tradeItemForm"+s;let c=document.createElement("div");c.classList.add("form-group");let g=document.createElement("label");g.setAttribute("for","makeModel"+s),g.innerHTML='Make, Model, and Color <span class="text-danger" role="none">*</span>';let b=document.createElement("input");b.setAttribute("type","text"),b.classList.add("form-control"),b.setAttribute("id","makeModel"+s),b.setAttribute("name","makeModel"+s),b.setAttribute("aria-describedby","makeModelHelpElement"+s),b.setAttribute("placeholder","E.g. EMPIRE AXE 2.0 Dust Black"),b.setAttribute("minlength","8"),b.required=!0;let y=document.createElement("small");y.setAttribute("id","makeModelHelpElement"+s),y.classList.add("form-text"),y.classList.add("text-muted"),y.innerHTML="",c.appendChild(g),c.appendChild(b),c.appendChild(y),o.appendChild(c);let L=document.createElement("div");L.classList.add("form-group");let h=document.createElement("label");h.setAttribute("for","qty"+s),h.innerHTML='Quantity <span class="text-danger" role="none">*</span>';let f=document.createElement("input");f.setAttribute("type","number"),f.classList.add("form-control"),f.setAttribute("id","qty"+s),f.setAttribute("name","qty"+s),f.setAttribute("aria-describedby","qtyHelpElement"),f.setAttribute("placeholder","E.g. 1"),f.setAttribute("min","1"),f.required=!0;let E=document.createElement("small");E.setAttribute("id","qtyHelpElement"+s),E.classList.add("form-text"),E.classList.add("text-muted"),E.innerHTML="How many of this item do you have?",L.appendChild(h),L.appendChild(f),L.appendChild(E),o.appendChild(L);let v=document.createElement("div");v.classList.add("form-group");let x=document.createElement("label");x.setAttribute("for","condition"+s),x.innerHTML='Condition <span class="text-danger" role="none">*</span>';let I=document.createElement("input");I.setAttribute("type","text"),I.classList.add("form-control"),I.setAttribute("id","condition"+s),I.setAttribute("name","condition"+s),I.setAttribute("aria-describedby","conditionHelpElement"),I.setAttribute("placeholder","E.g. Used"),I.setAttribute("minlength","4"),I.required=!0;let M=document.createElement("small");M.setAttribute("id","conditionHelpElement"+s),M.classList.add("form-text"),M.classList.add("text-muted"),M.innerHTML='If used please write "Used" and describe the visual and operational condition of the item(s). If brand new write "Brand New".',v.appendChild(x),v.appendChild(I),v.appendChild(M),o.appendChild(v);let H=document.createElement("div");H.classList.add("form-group");let S=document.createElement("label");S.setAttribute("for","upgradesMods"+s),S.innerHTML="Upgrades / Modifications (If Applicable)";let C=document.createElement("textarea");C.classList.add("form-control"),C.setAttribute("id","upgradesMods"+s),C.setAttribute("name","upgradesMods"+s),C.setAttribute("aria-describedby","upgradesModsHelpElement"),C.setAttribute("placeholder","E.g. Reflex Engine");let T=document.createElement("small");T.setAttribute("id","upgradesModsHelpElement"+s),T.classList.add("form-text"),T.classList.add("text-muted"),T.innerHTML="",H.appendChild(S),H.appendChild(C),H.appendChild(T),o.appendChild(H);let w=document.createElement("div");w.classList.add("form-group");let q=document.createElement("label");q.setAttribute("for","accessories"+s),q.innerHTML="Accessories (If Applicable)";let B=document.createElement("textarea");B.classList.add("form-control"),B.setAttribute("id","accessories"+s),B.setAttribute("name","accessories"+s),B.setAttribute("aria-describedby","accessoriesHelpElement"),B.setAttribute("placeholder","E.g. Barrel Bag");let $=document.createElement("small");$.setAttribute("id","accessoriesHelpElement"+s),$.classList.add("form-text"),$.classList.add("text-muted"),$.innerHTML="What all is included with the item(s)?",w.appendChild(q),w.appendChild(B),w.appendChild($),o.appendChild(w);let F=document.createElement("div");F.classList.add("form-group");let k=document.createElement("label");k.setAttribute("for","pictures"+s+"[]"),k.innerHTML=0==n?"Pictures":'Pictures <span class="text-danger" role="none">*</span>';let P=document.createElement("input");P.setAttribute("type","file"),P.setAttribute("accept","image/png, image/jpeg"),P.classList.add("form-control-file"),P.setAttribute("id","pictures"+s),P.setAttribute("name","pictures"+s+"[]"),P.setAttribute("aria-describedby","picturesHelpElement"),0!=n&&(P.required=!0),P.multiple=!0;let D=document.createElement("small");D.setAttribute("id","picturesHelpElement"+s),D.classList.add("form-text"),D.classList.add("text-muted"),D.innerHTML=`Provide ${n}-${d} pictures.`,P.addEventListener("input",()=>{P.files.length>d?(A(D,"Too many pictures selected.","warning",i,!0),P.value=""):P.files.length<n&&(A(D,"Select more pictures.","warning",i,!0),P.value="")}),F.appendChild(k),F.appendChild(P),F.appendChild(D),o.appendChild(F);let O=document.createElement("div");O.classList.add("form-group");let R=document.createElement("label");R.setAttribute("for","video"+s),R.innerHTML="Video";let U=document.createElement("input");U.setAttribute("type","url"),U.classList.add("form-control"),U.setAttribute("id","video"+s),U.setAttribute("name","video"+s),U.setAttribute("aria-describedby","videoHelpElement"),U.setAttribute("placeholder","E.g. https://youtu.be/dQw4w9WgXcQ");let W=document.createElement("small");W.setAttribute("id","videoHelpElement"+s),W.classList.add("form-text"),W.classList.add("text-muted"),W.innerHTML="If you have a video of your item(s) on YouTube or elsewhere you can put the URL link here.",O.appendChild(R),O.appendChild(U),O.appendChild(W),o.appendChild(O),l.appendChild(o),m.appendChild(a),document.querySelectorAll(".tradeItem").length>t&&(p.disabled=!1)}function f(e,t){let n=new Date,d=`${n.getFullYear()}-${n.getMonth().toString().padStart(2,"0")}-${n.getDate().toString().padStart(2,"0")} ${n.toTimeString()}`,s={timestamp:d,msg:e};L.push(s),!0===t&&console.log(`[${d}] ${e}`)}function E(){setTimeout(()=>{g.innerHTML="Submit",g.classList.add("btn-success"),g.classList.remove("btn-primary"),g.disabled=!1,document.getElementById("introSection").style.display="initial",document.getElementById("personalInfoSection").style.display="initial",document.getElementById("itemsSection").style.display="initial",document.getElementById("tradeOptionsSection").style.display="initial",document.getElementById("submitSection").style.display="initial",y.innerHTML="",b.innerHTML=""},i)}async function A(e,t,n,d,s){let a;return!0===s&&f(t,l),a=void 0===e.innerHTML?"":e.innerHTML,"warning"==n?(e.classList.add("text-danger"),e.classList.remove("text-muted"),e.classList.remove("text-primary"),e.classList.remove("text-success")):"pending"==n?(e.classList.add("text-primary"),e.classList.remove("text-muted"),e.classList.remove("text-danger"),e.classList.remove("text-success")):"success"==n&&(e.classList.add("text-success"),e.classList.remove("text-muted"),e.classList.remove("text-danger"),e.classList.remove("text-primary")),e.innerHTML=t,0==d||(await setTimeout(()=>{e.classList.add("text-muted"),e.classList.remove("text-danger"),e.classList.remove("text-primary"),e.classList.remove("text-success"),e.innerHTML=a},d),!0)}u.addEventListener("click",()=>{h()}),p.addEventListener("click",()=>{document.querySelectorAll(".tradeItem").length>t&&(m.removeChild(m.lastChild),document.querySelectorAll(".tradeItem").length==t&&(p.disabled=!0)),document.querySelectorAll(".tradeItem").length<e&&(u.disabled=!1)}),o.addEventListener("submit",n=>{g.innerHTML="Validating...",g.classList.add("btn-primary"),g.classList.remove("btn-success"),g.disabled=!0,document.getElementById("introSection").style.display="none",document.getElementById("personalInfoSection").style.display="none",document.getElementById("itemsSection").style.display="none",document.getElementById("tradeOptionsSection").style.display="none",async function(){if(f("Validating form.",l),document.querySelectorAll(".tradeItem").length<t)return A(b,"Not enough trade items!","warning",i,!0),!1;if(document.querySelectorAll(".tradeItem").length>e)return A(b,"Too many trade items!","warning",i,!0),!1;let n=0,d=0,r=Array.from(document.querySelectorAll("input[type=file]"));for(let e=0;e<r.length;e++){let t=Array.from(r[e].files);for(let o=0;o<t.length;o++){n+=t[o].size;const m={maxSizeMB:s,maxWidthOrHeight:a,useWebWorker:!1,onProgress:e=>{A(b,`Compressing "${t[o].name}" (${e}%)`,"pending",0,!1)}};try{f(`Compressing "${t[o].name}".`,l);const n=await imageCompression(t[o],m);c.append(`compressedPictures${e+1}[]`,n,n.name),d+=n.size}catch(n){A(b,`Failed to compress ${t[o].name}. Please remove it or try again.`,"warning",i,!0),r[e].value="";for(let e=0;e<r.length;e++)c.delete(`compressedPictures${e+1}[]`);return f(n,l),!1}}}if(A(b,`Compression finished and saved ${((n-d)/1024/1024).toFixed(2)} MBs. New total file upload size: ${(d/1024/1024).toFixed(2)} MBs.`,"success",0,!0),(d/1024/1024).toFixed(2)>25){A(b,`Total selected picture size of ${(d/1024/1024).toFixed(2)} MBs is too large. Please remove one and try again.`,"warning",i,!0);for(let e=0;e<r.length;e++)c.delete(`compressedPictures${e+1}[]`);return!1}return f("Validated form successfully.",l),!0}().then(e=>{e?(g.innerHTML="Sending...",function(){f(`Time taken to fill out form: ${(Date.now()-r)/1e3/60} minute(s).`,l),f("Sending trade.",l),c.append("numTradeItems",document.querySelectorAll(".tradeItem").length),document.querySelectorAll("input").forEach(e=>{-1==e.name.search("pictures")&&c.append(e.name,e.value)}),document.querySelectorAll("textarea").forEach(e=>{c.append(e.name,e.value)}),document.querySelectorAll("select").forEach(e=>{c.append(e.name,e.value)}),!0===l?c.append("debug","true"):c.append("debug","false"),c.append("csLog",JSON.stringify(L));let e=new XMLHttpRequest;e.upload.onprogress=e=>{A(b,`Uploading (${(e.loaded/e.total*100).toFixed(0)}%)`,"pending",0,!1),f("Uploading trade.",l)},e.onload=()=>{if(200==e.status){g.disabled=!0,g.innerHTML="Submitted!",g.classList.add("btn-success"),g.classList.remove("btn-primary"),document.getElementById("submitSection").style.display="none";let t=JSON.parse(e.response);y.innerHTML=t.header+t.body,!1===t.isFormInputValid?(f("Server rejected form as invalid.",l),E()):f("Submitted form successfully.",l),!0===l&&(console.log("Server-Side Debug Info:"),console.log(t.debugInfo))}else A(b,"Failed to send trade. Please check your internet connection and try again.","warning",i,!0),E()},e.onerror=()=>{A(b,"Failed to send trade. Please check your internet connection and try again.","warning",i,!0),E()},e.open("POST","trade.php"),e.send(c)}()):E()}).catch(e=>{f(e,l)}),n.preventDefault()}),o.addEventListener("invalid",()=>{document.querySelectorAll(".collapse").forEach(e=>{e.classList.add("show")})},!0),h(),o.style.display="initial"});