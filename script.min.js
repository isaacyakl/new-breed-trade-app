let formReady=e=>{"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",e)};formReady(()=>{const e=new Date;let t=document.getElementById("tradeForm"),n=new FormData,d=document.getElementById("itemsWrapper"),a=document.getElementById("addItem"),s=document.getElementById("removeItem"),i=document.getElementById("tradeSubmit"),l=document.getElementById("submitHelp"),r=document.getElementById("submissionResults"),o=[];function c(){if(document.querySelectorAll(".tradeItem").length>14)return;14==document.querySelectorAll(".tradeItem").length&&(a.disabled=!0);let e=document.querySelectorAll(".tradeItem").length+1,t=document.createElement("div");t.classList.add("row"),t.classList.add("tradeItem"),t.id="tradeItem"+e;let n=document.createElement("div");n.classList.add("col"),t.appendChild(n);let i=document.createElement("h4");i.id="tradeItemHeader"+e,i.setAttribute("data-toggle","collapse"),i.setAttribute("data-target","#tradeItemForm"+e),i.setAttribute("aria-expanded","true"),i.setAttribute("aria-controls","tradeItemForm"+e),i.classList.add("itemHeader"),i.innerHTML="Item "+e,n.appendChild(i);let l=document.createElement("div");l.classList.add("collapse"),l.classList.add("show"),l.classList.add("multi-collapse"),l.id="tradeItemForm"+e;let r=document.createElement("div");r.classList.add("form-group");let o=document.createElement("label");o.setAttribute("for","makeModel"+e),o.innerHTML='Make, Model, and Color <span class="text-danger" role="none">*</span>';let c=document.createElement("input");c.setAttribute("type","text"),c.classList.add("form-control"),c.setAttribute("id","makeModel"+e),c.setAttribute("name","makeModel"+e),c.setAttribute("aria-describedby","makeModelHelpElement"+e),c.setAttribute("placeholder","E.g. EMPIRE AXE 2.0 Dust Black"),c.setAttribute("minlength","8"),c.required=!0;let m=document.createElement("small");m.setAttribute("id","makeModelHelpElement"+e),m.classList.add("form-text"),m.classList.add("text-muted"),m.innerHTML="",r.appendChild(o),r.appendChild(c),r.appendChild(m),l.appendChild(r);let u=document.createElement("div");u.classList.add("form-group");let g=document.createElement("label");g.setAttribute("for","qty"+e),g.innerHTML='Quantity <span class="text-danger" role="none">*</span>';let b=document.createElement("input");b.setAttribute("type","number"),b.classList.add("form-control"),b.setAttribute("id","qty"+e),b.setAttribute("name","qty"+e),b.setAttribute("aria-describedby","qtyHelpElement"),b.setAttribute("placeholder","E.g. 1"),b.setAttribute("min","1"),b.required=!0;let y=document.createElement("small");y.setAttribute("id","qtyHelpElement"+e),y.classList.add("form-text"),y.classList.add("text-muted"),y.innerHTML="How many of this item do you have?",u.appendChild(g),u.appendChild(b),u.appendChild(y),l.appendChild(u);let L=document.createElement("div");L.classList.add("form-group");let h=document.createElement("label");h.setAttribute("for","condition"+e),h.innerHTML='Condition <span class="text-danger" role="none">*</span>';let E=document.createElement("input");E.setAttribute("type","text"),E.classList.add("form-control"),E.setAttribute("id","condition"+e),E.setAttribute("name","condition"+e),E.setAttribute("aria-describedby","conditionHelpElement"),E.setAttribute("placeholder","E.g. Used"),E.setAttribute("minlength","4"),E.required=!0;let f=document.createElement("small");f.setAttribute("id","conditionHelpElement"+e),f.classList.add("form-text"),f.classList.add("text-muted"),f.innerHTML='If used please write "Used" and describe the visual and operational condition of the item(s). If brand new write "Brand New".',L.appendChild(h),L.appendChild(E),L.appendChild(f),l.appendChild(L);let A=document.createElement("div");A.classList.add("form-group");let v=document.createElement("label");v.setAttribute("for","upgradesMods"+e),v.innerHTML="Upgrades / Modifications (If Applicable)";let x=document.createElement("textarea");x.classList.add("form-control"),x.setAttribute("id","upgradesMods"+e),x.setAttribute("name","upgradesMods"+e),x.setAttribute("aria-describedby","upgradesModsHelpElement"),x.setAttribute("placeholder","E.g. Reflex Engine");let M=document.createElement("small");M.setAttribute("id","upgradesModsHelpElement"+e),M.classList.add("form-text"),M.classList.add("text-muted"),M.innerHTML="",A.appendChild(v),A.appendChild(x),A.appendChild(M),l.appendChild(A);let H=document.createElement("div");H.classList.add("form-group");let I=document.createElement("label");I.setAttribute("for","accessories"+e),I.innerHTML="Accessories (If Applicable)";let C=document.createElement("textarea");C.classList.add("form-control"),C.setAttribute("id","accessories"+e),C.setAttribute("name","accessories"+e),C.setAttribute("aria-describedby","accessoriesHelpElement"),C.setAttribute("placeholder","E.g. Barrel Bag");let S=document.createElement("small");S.setAttribute("id","accessoriesHelpElement"+e),S.classList.add("form-text"),S.classList.add("text-muted"),S.innerHTML="What all is included with the item(s)?",H.appendChild(I),H.appendChild(C),H.appendChild(S),l.appendChild(H);let T=document.createElement("div");T.classList.add("form-group");let w=document.createElement("label");w.setAttribute("for","pictures"+e+"[]"),w.innerHTML='Pictures <span class="text-danger" role="none">*</span>';let q=document.createElement("input");q.setAttribute("type","file"),q.setAttribute("accept","image/png, image/jpeg"),q.classList.add("form-control-file"),q.setAttribute("id","pictures"+e),q.setAttribute("name","pictures"+e+"[]"),q.setAttribute("aria-describedby","picturesHelpElement"),q.required=!0,q.multiple=!0;let B=document.createElement("small");B.setAttribute("id","picturesHelpElement"+e),B.classList.add("form-text"),B.classList.add("text-muted"),B.innerHTML="Provide 2-10 pictures.",q.addEventListener("input",()=>{q.files.length>10?(p(B,"Too many pictures selected.","warning",4500,!0),q.value=""):q.files.length<2&&(p(B,"Select more pictures.","warning",4500,!0),q.value="")}),T.appendChild(w),T.appendChild(q),T.appendChild(B),l.appendChild(T);let $=document.createElement("div");$.classList.add("form-group");let F=document.createElement("label");F.setAttribute("for","video"+e),F.innerHTML="Video";let k=document.createElement("input");k.setAttribute("type","url"),k.classList.add("form-control"),k.setAttribute("id","video"+e),k.setAttribute("name","video"+e),k.setAttribute("aria-describedby","videoHelpElement"),k.setAttribute("placeholder","E.g. https://youtu.be/dQw4w9WgXcQ");let P=document.createElement("small");P.setAttribute("id","videoHelpElement"+e),P.classList.add("form-text"),P.classList.add("text-muted"),P.innerHTML="If you have a video of your item(s) on YouTube or elsewhere you can put the URL link here.",$.appendChild(F),$.appendChild(k),$.appendChild(P),l.appendChild($),n.appendChild(l),d.appendChild(t),document.querySelectorAll(".tradeItem").length>1&&(s.disabled=!1)}function m(e,t){let n=new Date,d=`${n.getFullYear()}-${n.getMonth().toString().padStart(2,"0")}-${n.getDate().toString().padStart(2,"0")} ${n.toTimeString()}`,a={timestamp:d,msg:e};o.push(a),!0===t&&console.log(`[${d}] ${e}`)}function u(){document.getElementById("submitSection").style.display="initial",setTimeout(()=>{i.innerHTML="Submit",i.classList.add("btn-success"),i.classList.remove("btn-primary"),i.disabled=!1,document.getElementById("introSection").style.display="initial",document.getElementById("personalInfoSection").style.display="initial",document.getElementById("itemsSection").style.display="initial",document.getElementById("tradeOptionsSection").style.display="initial",r.innerHTML="",l.innerHTML=""},4500)}async function p(e,t,n,d,a){let s;return!0===a&&m(t,!0),s=void 0===e.innerHTML?"":e.innerHTML,"warning"==n?(e.classList.add("text-danger"),e.classList.remove("text-muted"),e.classList.remove("text-primary"),e.classList.remove("text-success")):"pending"==n?(e.classList.add("text-primary"),e.classList.remove("text-muted"),e.classList.remove("text-danger"),e.classList.remove("text-success")):"success"==n&&(e.classList.add("text-success"),e.classList.remove("text-muted"),e.classList.remove("text-danger"),e.classList.remove("text-primary")),e.innerHTML=t,0==d||(await setTimeout(()=>{e.classList.add("text-muted"),e.classList.remove("text-danger"),e.classList.remove("text-primary"),e.classList.remove("text-success"),e.innerHTML=s},d),!0)}a.addEventListener("click",()=>{c()}),s.addEventListener("click",()=>{document.querySelectorAll(".tradeItem").length>1&&(d.removeChild(d.lastChild),1==document.querySelectorAll(".tradeItem").length&&(s.disabled=!0)),document.querySelectorAll(".tradeItem").length<15&&(a.disabled=!1)}),t.addEventListener("submit",t=>{i.innerHTML="Validating...",i.classList.add("btn-primary"),i.classList.remove("btn-success"),i.disabled=!0,document.getElementById("introSection").style.display="none",document.getElementById("personalInfoSection").style.display="none",document.getElementById("itemsSection").style.display="none",document.getElementById("tradeOptionsSection").style.display="none",async function(){if(m("Validating form.",!0),document.querySelectorAll(".tradeItem").length<1)return p(l,"Not enough trade items!","warning",4500,!0),!1;if(document.querySelectorAll(".tradeItem").length>15)return p(l,"Too many trade items!","warning",4500,!0),!1;let e=0,t=0,d=Array.from(document.querySelectorAll("input[type=file]"));for(let a=0;a<d.length;a++){let s=Array.from(d[a].files);for(let i=0;i<s.length;i++){e+=s[i].size;const r={maxSizeMB:1,maxWidthOrHeight:1440,useWebWorker:!1,onProgress:e=>{p(l,`Compressing "${s[i].name}" (${e}%)`,"pending",0,!1)}};try{m(`Compressing "${s[i].name}".`,!0);const e=await imageCompression(s[i],r);n.append(`compressedPictures${a+1}[]`,e,e.name),t+=e.size}catch(e){p(l,`Failed to compress ${s[i].name}. Please remove it or try again.`,"warning",4500,!0),d[a].value="";for(let e=0;e<d.length;e++)n.delete(`compressedPictures${e+1}[]`);return m(e,!0),!1}}}if(p(l,`Compression finished and saved ${((e-t)/1024/1024).toFixed(2)} MBs. New total file upload size: ${(t/1024/1024).toFixed(2)} MBs.`,"success",0,!0),(t/1024/1024).toFixed(2)>25){p(l,`Total selected picture size of ${(t/1024/1024).toFixed(2)} MBs is too large. Please remove one and try again.`,"warning",4500,!0);for(let e=0;e<d.length;e++)n.delete(`compressedPictures${e+1}[]`);return!1}return m("Validated form successfully.",!0),!0}().then(t=>{t?(i.innerHTML="Sending...",function(){m(`Time taken to fill out form: ${(Date.now()-e)/1e3/60} minute(s).`,!0),m("Sending trade.",!0),n.append("numTradeItems",document.querySelectorAll(".tradeItem").length),document.querySelectorAll("input").forEach(e=>{-1==e.name.search("pictures")&&n.append(e.name,e.value)}),document.querySelectorAll("textarea").forEach(e=>{n.append(e.name,e.value)}),document.querySelectorAll("select").forEach(e=>{n.append(e.name,e.value)}),n.append("debug","true"),n.append("csLog",JSON.stringify(o));let t=new XMLHttpRequest;t.upload.onprogress=e=>{p(l,`Uploading (${(e.loaded/e.total*100).toFixed(0)}%)`,"pending",0,!1),m("Uploading trade.",!0)},t.onload=()=>{if(200==t.status)return i.disabled=!0,i.innerHTML="Submitted!",i.classList.add("btn-success"),i.classList.remove("btn-primary"),document.getElementById("submitSection").style.display="none",console.log(t.responseText),p(l,"Failed to send trade because of an internal error. Please try again.","warning",4500,!0),void u();p(l,"Failed to send trade. Please check your internet connection and try again.","warning",4500,!0),u()},t.onerror=()=>{p(l,"Failed to send trade. Please check your internet connection and try again.","warning",4500,!0),u()},t.open("POST","trade.php"),t.send(n)}()):u()}).catch(e=>{m(e,!0)}),t.preventDefault()}),t.addEventListener("invalid",()=>{document.querySelectorAll(".collapse").forEach(e=>{e.classList.add("show")})},!0),c(),t.style.display="initial"});