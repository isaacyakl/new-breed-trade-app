let formReady=e=>{"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",e)};formReady(()=>{const e=15,t=1,n=2,d=10,i=1,s=1440,l=4500;let a=document.getElementById("tradeForm"),r=new FormData,o=document.getElementById("itemsWrapper"),c=document.getElementById("addItem"),m=document.getElementById("removeItem"),u=document.getElementById("tradeSubmit"),p=document.getElementById("submitHelp"),y=document.getElementById("submissionResults");function b(){if(document.querySelectorAll(".tradeItem").length>e-1)return;document.querySelectorAll(".tradeItem").length==e-1&&(c.disabled=!0);let i=document.querySelectorAll(".tradeItem").length+1,s=document.createElement("div");s.classList.add("row"),s.classList.add("tradeItem"),s.id="tradeItem"+i;let a=document.createElement("div");a.classList.add("col"),s.appendChild(a);let r=document.createElement("h4");r.id="tradeItemHeader"+i,r.setAttribute("data-toggle","collapse"),r.setAttribute("data-target","#tradeItemForm"+i),r.setAttribute("aria-expanded","true"),r.setAttribute("aria-controls","tradeItemForm"+i),r.classList.add("itemHeader"),r.innerHTML="Item "+i,a.appendChild(r);let u=document.createElement("div");u.classList.add("collapse"),u.classList.add("show"),u.classList.add("multi-collapse"),u.id="tradeItemForm"+i;let p=document.createElement("div");p.classList.add("form-group");let y=document.createElement("label");y.setAttribute("for","makeModel"+i),y.innerHTML='Make, Model, and Color <span class="text-danger" role="none">*</span>';let b=document.createElement("input");b.setAttribute("type","text"),b.classList.add("form-control"),b.setAttribute("id","makeModel"+i),b.setAttribute("name","makeModel"+i),b.setAttribute("aria-describedby","makeModelHelpElement"+i),b.setAttribute("placeholder","E.g. EMPIRE AXE 2.0 Dust Black"),b.setAttribute("minlength","8"),b.required=!0;let L=document.createElement("small");L.setAttribute("id","makeModelHelpElement"+i),L.classList.add("form-text"),L.classList.add("text-muted"),L.innerHTML="",p.appendChild(y),p.appendChild(b),p.appendChild(L),u.appendChild(p);let E=document.createElement("div");E.classList.add("form-group");let h=document.createElement("label");h.setAttribute("for","qty"+i),h.innerHTML='Quantity <span class="text-danger" role="none">*</span>';let f=document.createElement("input");f.setAttribute("type","number"),f.classList.add("form-control"),f.setAttribute("id","qty"+i),f.setAttribute("name","qty"+i),f.setAttribute("aria-describedby","qtyHelpElement"),f.setAttribute("placeholder","E.g. 1"),f.setAttribute("min","1"),f.required=!0;let A=document.createElement("small");A.setAttribute("id","qtyHelpElement"+i),A.classList.add("form-text"),A.classList.add("text-muted"),A.innerHTML="How many of this item do you have?",E.appendChild(h),E.appendChild(f),E.appendChild(A),u.appendChild(E);let I=document.createElement("div");I.classList.add("form-group");let v=document.createElement("label");v.setAttribute("for","condition"+i),v.innerHTML='Condition <span class="text-danger" role="none">*</span>';let M=document.createElement("input");M.setAttribute("type","text"),M.classList.add("form-control"),M.setAttribute("id","condition"+i),M.setAttribute("name","condition"+i),M.setAttribute("aria-describedby","conditionHelpElement"),M.setAttribute("placeholder","E.g. Used"),M.setAttribute("minlength","4"),M.required=!0;let H=document.createElement("small");H.setAttribute("id","conditionHelpElement"+i),H.classList.add("form-text"),H.classList.add("text-muted"),H.innerHTML='If used please write "Used" and describe the visual and operational condition of the item(s). If brand new write "Brand New".',I.appendChild(v),I.appendChild(M),I.appendChild(H),u.appendChild(I);let x=document.createElement("div");x.classList.add("form-group");let S=document.createElement("label");S.setAttribute("for","upgradesMods"+i),S.innerHTML="Upgrades / Modifications (If Applicable)";let C=document.createElement("textarea");C.classList.add("form-control"),C.setAttribute("id","upgradesMods"+i),C.setAttribute("name","upgradesMods"+i),C.setAttribute("aria-describedby","upgradesModsHelpElement"),C.setAttribute("placeholder","E.g. Reflex Engine");let T=document.createElement("small");T.setAttribute("id","upgradesModsHelpElement"+i),T.classList.add("form-text"),T.classList.add("text-muted"),T.innerHTML="",x.appendChild(S),x.appendChild(C),x.appendChild(T),u.appendChild(x);let B=document.createElement("div");B.classList.add("form-group");let w=document.createElement("label");w.setAttribute("for","accessories"+i),w.innerHTML="Accessories (If Applicable)";let q=document.createElement("textarea");q.classList.add("form-control"),q.setAttribute("id","accessories"+i),q.setAttribute("name","accessories"+i),q.setAttribute("aria-describedby","accessoriesHelpElement"),q.setAttribute("placeholder","E.g. Barrel Bag");let F=document.createElement("small");F.setAttribute("id","accessoriesHelpElement"+i),F.classList.add("form-text"),F.classList.add("text-muted"),F.innerHTML="What all is included with the item(s)?",B.appendChild(w),B.appendChild(q),B.appendChild(F),u.appendChild(B);let $=document.createElement("div");$.classList.add("form-group");let k=document.createElement("label");k.setAttribute("for","pictures"+i+"[]"),k.innerHTML=0==n?"Pictures":'Pictures <span class="text-danger" role="none">*</span>';let P=document.createElement("input");P.setAttribute("type","file"),P.setAttribute("accept","image/png, image/jpeg"),P.classList.add("form-control-file"),P.setAttribute("id","pictures"+i),P.setAttribute("name","pictures"+i+"[]"),P.setAttribute("aria-describedby","picturesHelpElement"),0!=n&&(P.required=!0),P.multiple=!0;let O=document.createElement("small");O.setAttribute("id","picturesHelpElement"+i),O.classList.add("form-text"),O.classList.add("text-muted"),O.innerHTML=`Provide ${n}-${d} pictures.`,P.addEventListener("input",()=>{P.files.length>d?(g(O,"Too many pictures selected.","warning",l),P.value=""):P.files.length<n&&(g(O,"Select more pictures.","warning",l),P.value="")}),$.appendChild(k),$.appendChild(P),$.appendChild(O),u.appendChild($);let R=document.createElement("div");R.classList.add("form-group");let z=document.createElement("label");z.setAttribute("for","video"+i),z.innerHTML="Video";let W=document.createElement("input");W.setAttribute("type","url"),W.classList.add("form-control"),W.setAttribute("id","video"+i),W.setAttribute("name","video"+i),W.setAttribute("aria-describedby","videoHelpElement"),W.setAttribute("placeholder","E.g. https://youtu.be/dQw4w9WgXcQ");let N=document.createElement("small");N.setAttribute("id","videoHelpElement"+i),N.classList.add("form-text"),N.classList.add("text-muted"),N.innerHTML="If you have a video of your item(s) on YouTube or elsewhere you can put the URL link here.",R.appendChild(z),R.appendChild(W),R.appendChild(N),u.appendChild(R),a.appendChild(u),o.appendChild(s),document.querySelectorAll(".tradeItem").length>t&&(m.disabled=!1)}function g(e,t,n,d,i){let s;function l(){"function"==typeof i&&i()}s=void 0===e.innerHTML?"":e.innerHTML,"warning"==n?(e.classList.remove("text-muted"),e.classList.add("text-danger")):"pending"==n?(e.classList.remove("text-muted"),e.classList.add("text-primary")):"success"==n&&(e.classList.remove("text-muted"),e.classList.add("text-success")),e.innerHTML=t,0!=d?setTimeout(()=>{"warning"==n?(e.classList.remove("text-danger"),e.classList.add("text-muted")):"pending"==n?(e.classList.remove("text-primary"),e.classList.add("text-muted")):"success"==n&&(e.classList.remove("text-success"),e.classList.add("text-muted")),e.innerHTML=s,l()},d):l()}c.addEventListener("click",()=>{b()}),m.addEventListener("click",()=>{document.querySelectorAll(".tradeItem").length>t&&(o.removeChild(o.lastChild),document.querySelectorAll(".tradeItem").length==t&&(m.disabled=!0)),document.querySelectorAll(".tradeItem").length<e&&(c.disabled=!1)}),a.addEventListener("submit",n=>{u.innerHTML="Validating...",u.classList.add("btn-primary"),u.classList.remove("btn-success"),u.disabled=!0,document.getElementById("introSection").style.display="none",document.getElementById("personalInfoSection").style.display="none",document.getElementById("itemsSection").style.display="none",document.getElementById("tradeOptionsSection").style.display="none",async function(){if(document.querySelectorAll(".tradeItem").length<t)return g(p,"Not enough trade items!","warning",l),!1;if(document.querySelectorAll(".tradeItem").length>e)return g(p,"Too many trade items!","warning",l),!1;let n=0,d=0,a=Array.from(document.querySelectorAll("input[type=file]"));for(let e=0;e<a.length;e++){let t=Array.from(a[e].files);for(let o=0;o<t.length;o++){n+=t[o].size;const c={maxSizeMB:i,maxWidthOrHeight:s,useWebWorker:!1,onProgress:e=>g(p,`Compressing ${t[o].name} (${e}%)`,"pending",0)};try{const n=await imageCompression(t[o],c);r.append(`compressedPictures${e+1}[]`,n,n.name),d+=n.size}catch(n){g(p,`Failed to compress ${t[o].name}. Please remove it or try again.`,"warning",l),a[e].value="";for(let e=0;e<a.length;e++)r.delete(`compressedPictures${e+1}[]`);return console.log(n),!1}}}if(g(p,`Compression finished and saved ${((n-d)/1024/1024).toFixed(2)} MBs. New total file upload size: ${(d/1024/1024).toFixed(2)} MBs.`,"success",0),console.log(`Compression finished and saved ${((n-d)/1024/1024).toFixed(2)} MBs. New total file upload size: ${(d/1024/1024).toFixed(2)} MBs.`),(d/1024/1024).toFixed(2)>25){g(p,`Total selected picture size of ${(d/1024/1024).toFixed(2)} MBs is too large. Please remove one and try again.`,"warning",l);for(let e=0;e<a.length;e++)r.delete(`compressedPictures${e+1}[]`);return!1}return!0}().then(e=>{e?(u.innerHTML="Sending...",function(){p.innerHTML="",r.append("numTradeItems",document.querySelectorAll(".tradeItem").length),document.querySelectorAll("input").forEach(e=>{-1==e.name.search("pictures")&&r.append(e.name,e.value)}),document.querySelectorAll("textarea").forEach(e=>{r.append(e.name,e.value)}),document.querySelectorAll("select").forEach(e=>{r.append(e.name,e.value)}),r.append("debug","false");let e=new XMLHttpRequest;e.open("POST","trade.php"),e.send(r),e.onload=()=>{u.disabled=!0,u.innerHTML="Submitted!",u.classList.add("btn-success"),u.classList.remove("btn-primary"),document.getElementById("submitSection").style.display="none";let t=JSON.parse(e.response);y.innerHTML=t.header+t.body,!1===t.isFormInputValid&&(u.innerHTML="Submit",u.classList.add("btn-success"),u.classList.remove("btn-primary"),u.disabled=!1,setTimeout(()=>{document.getElementById("introSection").style.display="initial",document.getElementById("personalInfoSection").style.display="initial",document.getElementById("itemsSection").style.display="initial",document.getElementById("tradeOptionsSection").style.display="initial",document.getElementById("submitSection").style.display="initial",y.innerHTML=""},l))},e.onerror=()=>{g(p,"Failed to send trade. Please check your internet connection and try again.","warning",l),u.innerHTML="Submit",u.classList.add("btn-success"),u.classList.remove("btn-primary"),u.disabled=!1,setTimeout(()=>{document.getElementById("introSection").style.display="initial",document.getElementById("personalInfoSection").style.display="initial",document.getElementById("itemsSection").style.display="initial",document.getElementById("tradeOptionsSection").style.display="initial"},l)}}()):(u.innerHTML="Submit",u.classList.add("btn-success"),u.classList.remove("btn-primary"),u.disabled=!1,setTimeout(()=>{document.getElementById("introSection").style.display="initial",document.getElementById("personalInfoSection").style.display="initial",document.getElementById("itemsSection").style.display="initial",document.getElementById("tradeOptionsSection").style.display="initial"},l))}).catch(e=>{console.log(e)}),n.preventDefault()}),a.addEventListener("invalid",()=>{document.querySelectorAll(".collapse").forEach(e=>{e.classList.add("show")})},!0),b(),a.style.display="initial"});