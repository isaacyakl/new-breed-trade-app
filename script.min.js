let formReady=e=>{"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",e)};formReady(()=>{const e=new Date;let t=document.getElementById("tradeForm"),n=new FormData,d=document.getElementById("itemsWrapper"),s=document.getElementById("addItem"),a=document.getElementById("removeItem"),l=document.getElementById("tradeSubmit"),i=document.getElementById("submitHelp"),r=document.getElementById("submissionResults"),o=[];const c="true"==function(e){let t=e;t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");let n=new RegExp("[\\?|&]"+t+"=([^&#]*)").exec("?"+document.location.toString().split("?")[1]);return null===n?"":decodeURIComponent(n[1].replace(/\+/g,"%20"))}("debug");function m(){if(document.querySelectorAll(".tradeItem").length>14)return;14==document.querySelectorAll(".tradeItem").length&&(s.disabled=!0);let e=document.querySelectorAll(".tradeItem").length+1,t=document.createElement("div");t.classList.add("row"),t.classList.add("tradeItem"),t.id="tradeItem"+e;let n=document.createElement("div");n.classList.add("col"),t.appendChild(n);let l=document.createElement("h4");l.id="tradeItemHeader"+e,l.setAttribute("data-toggle","collapse"),l.setAttribute("data-target","#tradeItemForm"+e),l.setAttribute("aria-expanded","true"),l.setAttribute("aria-controls","tradeItemForm"+e),l.classList.add("itemHeader"),l.innerHTML="Item "+e,n.appendChild(l);let i=document.createElement("div");i.classList.add("collapse"),i.classList.add("show"),i.classList.add("multi-collapse"),i.id="tradeItemForm"+e;let r=document.createElement("div");r.classList.add("form-group");let o=document.createElement("label");o.setAttribute("for","makeModel"+e),o.innerHTML='Make, Model, Color, Size, etc. <span class="text-danger" role="none">*</span>';let c=document.createElement("input");c.setAttribute("type","text"),c.classList.add("form-control"),c.setAttribute("id","makeModel"+e),c.setAttribute("name","makeModel"+e),c.setAttribute("aria-describedby","makeModelHelpElement"+e),c.setAttribute("placeholder","E.g. EMPIRE AXE 2.0 Dust Black"),c.setAttribute("minlength","8"),c.required=!0;let m=document.createElement("small");m.setAttribute("id","makeModelHelpElement"+e),m.classList.add("form-text"),m.classList.add("text-muted"),m.innerHTML="",r.appendChild(o),r.appendChild(c),r.appendChild(m),i.appendChild(r);let u=document.createElement("div");u.classList.add("form-group");let p=document.createElement("label");p.setAttribute("for","qty"+e),p.innerHTML='Quantity <span class="text-danger" role="none">*</span>';let b=document.createElement("input");b.setAttribute("type","number"),b.classList.add("form-control"),b.setAttribute("id","qty"+e),b.setAttribute("name","qty"+e),b.setAttribute("aria-describedby","qtyHelpElement"),b.setAttribute("placeholder","E.g. 1"),b.setAttribute("min","1"),b.required=!0;let y=document.createElement("small");y.setAttribute("id","qtyHelpElement"+e),y.classList.add("form-text"),y.classList.add("text-muted"),y.innerHTML="How many of this item do you have?",u.appendChild(p),u.appendChild(b),u.appendChild(y),i.appendChild(u);let h=document.createElement("div");h.classList.add("form-group");let L=document.createElement("label");L.setAttribute("for","condition"+e),L.innerHTML='Condition <span class="text-danger" role="none">*</span>';let f=document.createElement("input");f.setAttribute("type","text"),f.classList.add("form-control"),f.setAttribute("id","condition"+e),f.setAttribute("name","condition"+e),f.setAttribute("aria-describedby","conditionHelpElement"),f.setAttribute("placeholder","E.g. Used"),f.setAttribute("minlength","4"),f.required=!0;let E=document.createElement("small");E.setAttribute("id","conditionHelpElement"+e),E.classList.add("form-text"),E.classList.add("text-muted"),E.innerHTML='If used please write "Used" and describe the visual and operational condition of the item(s). If brand new write "Brand New".',h.appendChild(L),h.appendChild(f),h.appendChild(E),i.appendChild(h);let A=document.createElement("div");A.classList.add("form-group");let v=document.createElement("label");v.setAttribute("for","upgradesMods"+e),v.innerHTML="Upgrades / Modifications (If Applicable)";let x=document.createElement("textarea");x.classList.add("form-control"),x.setAttribute("id","upgradesMods"+e),x.setAttribute("name","upgradesMods"+e),x.setAttribute("aria-describedby","upgradesModsHelpElement"),x.setAttribute("placeholder","E.g. Reflex Engine");let I=document.createElement("small");I.setAttribute("id","upgradesModsHelpElement"+e),I.classList.add("form-text"),I.classList.add("text-muted"),I.innerHTML="",A.appendChild(v),A.appendChild(x),A.appendChild(I),i.appendChild(A);let S=document.createElement("div");S.classList.add("form-group");let M=document.createElement("label");M.setAttribute("for","accessories"+e),M.innerHTML="Accessories (If Applicable)";let H=document.createElement("textarea");H.classList.add("form-control"),H.setAttribute("id","accessories"+e),H.setAttribute("name","accessories"+e),H.setAttribute("aria-describedby","accessoriesHelpElement"),H.setAttribute("placeholder","E.g. Barrel Bag");let C=document.createElement("small");C.setAttribute("id","accessoriesHelpElement"+e),C.classList.add("form-text"),C.classList.add("text-muted"),C.innerHTML="What all is included with the item(s)?",S.appendChild(M),S.appendChild(H),S.appendChild(C),i.appendChild(S);let T=document.createElement("div");T.classList.add("form-group");let w=document.createElement("label");w.setAttribute("for","pictures"+e+"[]"),w.innerHTML='Pictures <span class="text-danger" role="none">*</span>';let q=document.createElement("input");q.setAttribute("type","file"),q.setAttribute("accept","image/png, image/jpeg"),q.classList.add("form-control-file"),q.setAttribute("id","pictures"+e),q.setAttribute("name","pictures"+e+"[]"),q.setAttribute("aria-describedby","picturesHelpElement"),q.required=!0,q.multiple=!0;let B=document.createElement("small");B.setAttribute("id","picturesHelpElement"+e),B.classList.add("form-text"),B.classList.add("text-muted"),B.innerHTML="Provide 2-10 pictures.",q.addEventListener("input",()=>{q.files.length>10?(g(B,"Too many pictures selected.","warning",4500,!0),q.value=""):q.files.length<2&&(g(B,"Select more pictures.","warning",4500,!0),q.value="")}),T.appendChild(w),T.appendChild(q),T.appendChild(B),i.appendChild(T);let $=document.createElement("div");$.classList.add("form-group");let F=document.createElement("label");F.setAttribute("for","video"+e),F.innerHTML="Video";let k=document.createElement("input");k.setAttribute("type","url"),k.classList.add("form-control"),k.setAttribute("id","video"+e),k.setAttribute("name","video"+e),k.setAttribute("aria-describedby","videoHelpElement"),k.setAttribute("placeholder","E.g. https://youtu.be/dQw4w9WgXcQ");let P=document.createElement("small");P.setAttribute("id","videoHelpElement"+e),P.classList.add("form-text"),P.classList.add("text-muted"),P.innerHTML="If you have a video of your item(s) on YouTube or elsewhere you can put the URL link here.",$.appendChild(F),$.appendChild(k),$.appendChild(P),i.appendChild($),n.appendChild(i),d.appendChild(t),document.querySelectorAll(".tradeItem").length>1&&(a.disabled=!1)}function u(e,t){let n=new Date,d=`${n.getFullYear()}-${n.getMonth().toString().padStart(2,"0")}-${n.getDate().toString().padStart(2,"0")} ${n.toTimeString()}`,s={timestamp:d,msg:e};o.push(s),!0===t&&console.log(`[${d}] ${e}`)}function p(){document.getElementById("submitSection").style.display="initial",setTimeout(()=>{l.innerHTML="Submit",l.classList.add("btn-success"),l.classList.remove("btn-primary"),l.disabled=!1,document.getElementById("introSection").style.display="initial",document.getElementById("personalInfoSection").style.display="initial",document.getElementById("itemsSection").style.display="initial",document.getElementById("tradeOptionsSection").style.display="initial",r.innerHTML="",i.innerHTML=""},4500)}async function g(e,t,n,d,s){let a;return!0===s&&u(t,c),a=void 0===e.innerHTML?"":e.innerHTML,"warning"==n?(e.classList.add("text-danger"),e.classList.remove("text-muted"),e.classList.remove("text-primary"),e.classList.remove("text-success")):"pending"==n?(e.classList.add("text-primary"),e.classList.remove("text-muted"),e.classList.remove("text-danger"),e.classList.remove("text-success")):"success"==n&&(e.classList.add("text-success"),e.classList.remove("text-muted"),e.classList.remove("text-danger"),e.classList.remove("text-primary")),e.innerHTML=t,0==d||(await setTimeout(()=>{e.classList.add("text-muted"),e.classList.remove("text-danger"),e.classList.remove("text-primary"),e.classList.remove("text-success"),e.innerHTML=a},d),!0)}s.addEventListener("click",()=>{m()}),a.addEventListener("click",()=>{document.querySelectorAll(".tradeItem").length>1&&(d.removeChild(d.lastChild),1==document.querySelectorAll(".tradeItem").length&&(a.disabled=!0)),document.querySelectorAll(".tradeItem").length<15&&(s.disabled=!1)}),t.addEventListener("submit",t=>{l.innerHTML="Validating...",l.classList.add("btn-primary"),l.classList.remove("btn-success"),l.disabled=!0,document.getElementById("introSection").style.display="none",document.getElementById("personalInfoSection").style.display="none",document.getElementById("itemsSection").style.display="none",document.getElementById("tradeOptionsSection").style.display="none",async function(){if(u("Validating form.",c),document.querySelectorAll(".tradeItem").length<1)return g(i,"Not enough trade items!","warning",4500,!0),!1;if(document.querySelectorAll(".tradeItem").length>15)return g(i,"Too many trade items!","warning",4500,!0),!1;let e=0,t=0,d=Array.from(document.querySelectorAll("input[type=file]"));for(let s=0;s<d.length;s++){let a=Array.from(d[s].files);for(let l=0;l<a.length;l++){e+=a[l].size;const r={maxSizeMB:1,maxWidthOrHeight:1440,useWebWorker:!1,onProgress:e=>{g(i,`Compressing "${a[l].name}" (${e}%)`,"pending",0,!1)}};try{u(`Compressing "${a[l].name}".`,c);const e=await imageCompression(a[l],r);n.append(`compressedPictures${s+1}[]`,e,e.name),t+=e.size}catch(e){g(i,`Failed to compress ${a[l].name}. Please remove it or try again.`,"warning",4500,!0),d[s].value="";for(let e=0;e<d.length;e++)n.delete(`compressedPictures${e+1}[]`);return u(e,c),!1}}}if(g(i,`Compression finished and saved ${((e-t)/1024/1024).toFixed(2)} MBs. New total file upload size: ${(t/1024/1024).toFixed(2)} MBs.`,"success",0,!0),(t/1024/1024).toFixed(2)>25){g(i,`Total selected picture size of ${(t/1024/1024).toFixed(2)} MBs is too large. Please remove one and try again.`,"warning",4500,!0);for(let e=0;e<d.length;e++)n.delete(`compressedPictures${e+1}[]`);return!1}return u("Validated form successfully.",c),!0}().then(t=>{t?(l.innerHTML="Sending...",function(){u(`Time taken to fill out form: ${(Date.now()-e)/1e3/60} minute(s).`,c),u("Sending trade.",c),n.append("numTradeItems",document.querySelectorAll(".tradeItem").length),document.querySelectorAll("input").forEach(e=>{-1==e.name.search("pictures")&&n.append(e.name,e.value)}),document.querySelectorAll("textarea").forEach(e=>{n.append(e.name,e.value)}),document.querySelectorAll("select").forEach(e=>{n.append(e.name,e.value)}),!0===c?n.append("debug","true"):n.append("debug","false"),n.append("csLog",JSON.stringify(o));let t=new XMLHttpRequest;t.upload.onprogress=e=>{g(i,`Uploading (${(e.loaded/e.total*100).toFixed(0)}%). This may take a while; please be patient.`,"pending",0,c)},t.onload=()=>{if(200==t.status){if(l.disabled=!0,l.innerHTML="Submitted!",l.classList.add("btn-success"),l.classList.remove("btn-primary"),document.getElementById("submitSection").style.display="none","{"!==t.responseText.charAt(0)&&"["!==t.responseText.charAt(0))return!0===c&&(console.log("Server-Side Debug Info:"),console.log(t.responseText)),g(i,"Failed to send trade because of an internal error. Please try again.","warning",4500,!0),void p();let e=JSON.parse(t.response);r.innerHTML=e.header+e.body,!1===e.isFormInputValid?(u("Server rejected form as invalid.",c),p()):u("Submitted form successfully.",c),!0===c&&(console.log("Server-Side Debug Info:"),console.log(e.debugInfo))}else g(i,"Failed to send trade. Please check your internet connection and try again.","warning",4500,!0),p()},t.onerror=()=>{g(i,"Failed to send trade. Please check your internet connection and try again.","warning",4500,!0),p()},t.open("POST","trade-processor.php"),t.send(n)}()):p()}).catch(e=>{u(e,c)}),t.preventDefault()}),t.addEventListener("invalid",()=>{document.querySelectorAll(".collapse").forEach(e=>{e.classList.add("show")})},!0),m(),t.style.display="initial"});